<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cozy Blob Companion</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #f5f0ff 0%, #e8e4f0 100%);
            font-family: system-ui, -apple-system, sans-serif;
            overflow: hidden;
        }

        .companion-container {
            position: relative;
            width: 200px;
            height: 200px;
        }

        .blob {
            position: absolute;
            width: 100%;
            height: 100%;
            animation: idle-bob 3s ease-in-out infinite;
            transform-origin: center bottom;
        }

        .blob-body {
            width: 180px;
            height: 160px;
            background: linear-gradient(180deg, #ffffff 0%, #f8f6ff 100%);
            border-radius: 50% 50% 45% 45%;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 
                0 8px 32px rgba(180, 160, 200, 0.3),
                inset 0 -8px 20px rgba(200, 180, 220, 0.2);
            transition: transform 0.15s ease-out, background 0.3s ease, box-shadow 0.3s ease;
        }

        .blob-body.squish {
            animation: squish-stretch 0.3s ease-out;
        }

        .blob-body.happy {
            animation: happy-bounce 0.5s ease-out;
        }

        .blob-body.surprised {
            animation: surprised-jump 0.4s ease-out;
        }

        .blob-body.excited {
            animation: excited-wiggle 0.6s ease-in-out;
        }

        .blob-shadow {
            position: absolute;
            width: 140px;
            height: 30px;
            background: radial-gradient(ellipse, rgba(180, 160, 200, 0.4) 0%, transparent 70%);
            border-radius: 50%;
            left: 50%;
            bottom: 10px;
            transform: translateX(-50%);
            animation: shadow-pulse 3s ease-in-out infinite;
        }

        .face {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -60%);
            width: 100px;
            height: 50px;
        }

        .eye {
            position: absolute;
            width: 28px;
            height: 28px;
            background: #ffffff;
            border-radius: 50%;
            top: 0;
            transition: height 0.1s ease-out;
        }

        .eye.left {
            left: 15px;
        }

        .eye.right {
            right: 15px;
        }

        .eye.blink {
            height: 4px;
            border-radius: 50%;
        }

        .eye.wide {
            height: 34px;
            width: 34px;
        }

        .pupil {
            position: absolute;
            width: 14px;
            height: 14px;
            background: #2d2d2d;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .pupil::after {
            content: '';
            position: absolute;
            width: 5px;
            height: 5px;
            background: #ffffff;
            border-radius: 50%;
            top: 2px;
            right: 2px;
        }

        .mouth {
            position: absolute;
            width: 12px;
            height: 6px;
            border: 2px solid #e0d8e8;
            border-top: none;
            border-radius: 0 0 12px 12px;
            left: 50%;
            bottom: 8px;
            transform: translateX(-50%);
            transition: all 0.2s ease-out;
        }

        .mouth.happy {
            width: 20px;
            height: 12px;
            border-color: #d0c0e0;
        }

        .mouth.surprised {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #e0d8e8;
            border: none;
        }

        .mouth.excited {
            width: 24px;
            height: 14px;
            border-color: #d0c0e0;
        }

        .cheek {
            position: absolute;
            width: 18px;
            height: 10px;
            background: radial-gradient(ellipse, rgba(255, 180, 200, 0.4) 0%, transparent 70%);
            border-radius: 50%;
            top: 25px;
        }

        .cheek.left {
            left: 5px;
        }

        .cheek.right {
            right: 5px;
        }

        .cheek.blush {
            background: radial-gradient(ellipse, rgba(255, 150, 180, 0.6) 0%, transparent 70%);
        }

        /* Accessories */
        .accessory {
            position: absolute;
            pointer-events: none;
        }

        .bow {
            display: none;
            width: 60px;
            height: 30px;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
        }

        .bow.visible {
            display: block;
        }

        .bow-left, .bow-right {
            position: absolute;
            width: 24px;
            height: 24px;
            background: linear-gradient(135deg, #ffb6c1 0%, #ff9eb5 100%);
            border-radius: 50%;
        }

        .bow-left {
            left: 0;
            transform: rotate(-15deg);
        }

        .bow-right {
            right: 0;
            transform: rotate(15deg);
        }

        .bow-center {
            position: absolute;
            width: 12px;
            height: 12px;
            background: #ff8fa8;
            border-radius: 50%;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }

        .glasses {
            display: none;
            width: 100px;
            height: 35px;
            top: -2px;
            left: 50%;
            transform: translateX(-50%);
        }

        .glasses.visible {
            display: block;
        }

        .glasses-frame {
            position: absolute;
            width: 32px;
            height: 32px;
            border: 3px solid #8b7d9b;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
        }

        .glasses-frame.left {
            left: 8px;
        }

        .glasses-frame.right {
            right: 8px;
        }

        .glasses-bridge {
            position: absolute;
            width: 20px;
            height: 3px;
            background: #8b7d9b;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }

        .hat {
            display: none;
            width: 80px;
            height: 50px;
            top: -35px;
            left: 50%;
            transform: translateX(-50%);
        }

        .hat.visible {
            display: block;
        }

        .hat-brim {
            position: absolute;
            width: 80px;
            height: 12px;
            background: linear-gradient(180deg, #a890b8 0%, #9078a8 100%);
            border-radius: 50%;
            bottom: 0;
        }

        .hat-crown {
            position: absolute;
            width: 50px;
            height: 40px;
            background: linear-gradient(180deg, #b8a0c8 0%, #a088b8 100%);
            border-radius: 50% 50% 0 0;
            bottom: 6px;
            left: 50%;
            transform: translateX(-50%);
        }

        .hat-pom {
            position: absolute;
            width: 16px;
            height: 16px;
            background: #d0c0e0;
            border-radius: 50%;
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
        }

        /* Customization panel */
        .custom-panel {
            position: fixed;
            bottom: 130px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.95);
            padding: 15px 20px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(180, 160, 200, 0.3);
            display: flex;
            gap: 12px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            z-index: 100;
        }

        .custom-panel.visible {
            opacity: 1;
            pointer-events: auto;
        }

        .custom-btn {
            padding: 8px 16px;
            border: 2px solid #e8e0f0;
            background: #f8f6ff;
            border-radius: 12px;
            cursor: pointer;
            font-size: 13px;
            color: #8b7d9b;
            transition: all 0.2s ease;
        }

        .custom-btn:hover {
            background: #e8e0f0;
            transform: translateY(-2px);
        }

        .custom-btn.active {
            background: #d0c0e0;
            border-color: #b8a0c8;
            color: #6b5d7b;
        }

        .color-divider {
            width: 2px;
            background: #e8e0f0;
            margin: 0 4px;
            border-radius: 2px;
        }

        .color-swatch {
            width: 28px;
            height: 28px;
            border: 2px solid #e8e0f0;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s ease;
            padding: 0;
        }

        .color-swatch:hover {
            transform: scale(1.15);
            border-color: #d0c0e0;
        }

        .color-swatch.active {
            border-color: #8b7d9b;
            transform: scale(1.1);
            box-shadow: 0 2px 8px rgba(180, 160, 200, 0.4);
        }

        .panel-toggle {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 10px 20px;
            background: linear-gradient(135deg, #d0c0e0 0%, #c0b0d8 100%);
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 13px;
            color: white;
            box-shadow: 0 4px 16px rgba(180, 160, 200, 0.4);
            transition: all 0.2s ease;
            z-index: 100;
        }

        .panel-toggle:hover {
            transform: translateX(-50%) translateY(-2px);
            box-shadow: 0 6px 20px rgba(180, 160, 200, 0.5);
        }

        @keyframes idle-bob {
            0%, 100% {
                transform: translateY(0) rotate(0deg);
            }
            25% {
                transform: translateY(-3px) rotate(-1deg);
            }
            75% {
                transform: translateY(-3px) rotate(1deg);
            }
        }

        @keyframes shadow-pulse {
            0%, 100% {
                transform: translateX(-50%) scale(1);
                opacity: 1;
            }
            50% {
                transform: translateX(-50%) scale(0.95);
                opacity: 0.8;
            }
        }

        @keyframes squish-stretch {
            0% {
                transform: translate(-50%, -50%) scale(1, 1);
            }
            30% {
                transform: translate(-50%, -50%) scale(0.88, 1.1);
            }
            60% {
                transform: translate(-50%, -50%) scale(1.05, 0.92);
            }
            100% {
                transform: translate(-50%, -50%) scale(1, 1);
            }
        }

        @keyframes happy-bounce {
            0% {
                transform: translate(-50%, -50%) scale(1, 1);
            }
            30% {
                transform: translate(-50%, -50%) scale(1.1, 0.9);
            }
            60% {
                transform: translate(-50%, -50%) scale(0.95, 1.05) translateY(-10px);
            }
            100% {
                transform: translate(-50%, -50%) scale(1, 1);
            }
        }

        @keyframes surprised-jump {
            0% {
                transform: translate(-50%, -50%) scale(1, 1);
            }
            40% {
                transform: translate(-50%, -50%) scale(1.05, 0.95) translateY(-15px);
            }
            100% {
                transform: translate(-50%, -50%) scale(1, 1);
            }
        }

        @keyframes excited-wiggle {
            0%, 100% {
                transform: translate(-50%, -50%) rotate(0deg);
            }
            20% {
                transform: translate(-50%, -50%) rotate(-8deg) scale(1.05, 0.95);
            }
            40% {
                transform: translate(-50%, -50%) rotate(8deg) scale(1.05, 0.95);
            }
            60% {
                transform: translate(-50%, -50%) rotate(-8deg) scale(1.05, 0.95);
            }
            80% {
                transform: translate(-50%, -50%) rotate(8deg) scale(1.05, 0.95);
            }
        }

        .info {
            position: fixed;
            bottom: 55px;
            color: #a090b0;
            font-size: 13px;
            text-align: center;
        }

        /* Stats panel */
        .stats-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px 20px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(180, 160, 200, 0.3);
            display: flex;
            flex-direction: column;
            gap: 12px;
            min-width: 180px;
            z-index: 100;
        }

        .stat-row {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .stat-icon {
            font-size: 18px;
            width: 24px;
            text-align: center;
        }

        .stat-label {
            font-size: 11px;
            color: #8b7d9b;
            width: 50px;
            font-weight: 500;
        }

        .stat-bar-container {
            flex: 1;
            height: 16px;
            background: #f0e8f8;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
        }

        .stat-bar-fill {
            height: 100%;
            border-radius: 8px;
            transition: width 0.5s ease, background 0.3s ease;
            position: relative;
        }

        .stat-bar-fill::after {
            content: attr(data-percent);
            position: absolute;
            right: 6px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 10px;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 600;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .stat-bar-fill.hunger {
            background: linear-gradient(90deg, #ffb366 0%, #ff9933 100%);
        }

        .stat-bar-fill.love {
            background: linear-gradient(90deg, #ffb6c1 0%, #ff8fa8 100%);
        }

        /* Egg tarts panel */
        .tarts-panel {
            position: fixed;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(180, 160, 200, 0.3);
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 100;
        }

        .tarts-title {
            font-size: 12px;
            color: #8b7d9b;
            text-align: center;
            margin-bottom: 5px;
        }

        /* Toys panel */
        .toys-panel {
            position: fixed;
            bottom: 180px;
            left: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(180, 160, 200, 0.3);
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 100;
        }

        .toys-title {
            font-size: 12px;
            color: #8b7d9b;
            text-align: center;
        }

        .toys-hint {
            font-size: 9px;
            color: #a090b0;
            text-align: center;
            margin-top: 5px;
        }

        /* Take out button */
        .takeout-btn {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 24px;
            background: linear-gradient(135deg, #a8e6cf 0%, #88d8b0 100%);
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            color: white;
            font-weight: 600;
            box-shadow: 0 4px 16px rgba(136, 216, 176, 0.4);
            transition: all 0.2s ease;
            z-index: 100;
        }

        .takeout-btn:hover {
            transform: translateX(-50%) translateY(-2px);
            box-shadow: 0 6px 20px rgba(136, 216, 176, 0.5);
        }

        .takeout-btn.out {
            background: linear-gradient(135deg, #ffaaa5 0%, #ff8b85 100%);
            box-shadow: 0 4px 16px rgba(255, 139, 133, 0.4);
        }

        .takeout-btn.out:hover {
            box-shadow: 0 6px 20px rgba(255, 139, 133, 0.5);
        }

        /* Outdoor mode */
        body.outdoor {
            background: linear-gradient(180deg, #87ceeb 0%, #98d8aa 40%, #7ec85b 100%);
        }

        body.outdoor .companion-container {
            animation: outdoor-float 4s ease-in-out infinite;
        }

        @keyframes outdoor-float {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-10px);
            }
        }

        /* Clouds */
        .cloud {
            position: fixed;
            background: white;
            border-radius: 50px;
            opacity: 0.9;
            pointer-events: none;
            z-index: 1;
        }

        .cloud::before, .cloud::after {
            content: '';
            position: absolute;
            background: white;
            border-radius: 50%;
        }

        .cloud-1 {
            width: 100px;
            height: 40px;
            top: 80px;
            left: -120px;
            animation: cloud-move 25s linear infinite;
        }

        .cloud-1::before {
            width: 50px;
            height: 50px;
            top: -25px;
            left: 15px;
        }

        .cloud-1::after {
            width: 40px;
            height: 40px;
            top: -15px;
            left: 45px;
        }

        .cloud-2 {
            width: 120px;
            height: 45px;
            top: 150px;
            left: -140px;
            animation: cloud-move 35s linear infinite;
            animation-delay: 10s;
        }

        .cloud-2::before {
            width: 60px;
            height: 60px;
            top: -30px;
            left: 20px;
        }

        .cloud-2::after {
            width: 45px;
            height: 45px;
            top: -18px;
            left: 55px;
        }

        @keyframes cloud-move {
            0% {
                left: -150px;
            }
            100% {
                left: 100%;
            }
        }

        /* Butterflies in outdoor mode */
        .butterfly {
            position: fixed;
            font-size: 20px;
            pointer-events: none;
            z-index: 2;
            animation: butterfly-fly 8s ease-in-out infinite;
        }

        @keyframes butterfly-fly {
            0%, 100% {
                transform: translate(0, 0) rotate(0deg);
            }
            25% {
                transform: translate(100px, -50px) rotate(10deg);
            }
            50% {
                transform: translate(200px, 0) rotate(0deg);
            }
            75% {
                transform: translate(100px, 50px) rotate(-10deg);
            }
        }

        .toy {
            width: 55px;
            height: 55px;
            cursor: pointer;
            transition: transform 0.2s ease;
            position: relative;
            font-size: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8f6ff;
            border-radius: 15px;
            border: 2px solid #e8e0f0;
        }

        .toy:hover {
            transform: scale(1.15) rotate(5deg);
            background: #f0e8f8;
        }

        .toy:active {
            transform: scale(0.9);
        }

        .toy.playing {
            animation: toy-bounce 0.5s ease-in-out;
        }

        @keyframes toy-bounce {
            0%, 100% {
                transform: scale(1) rotate(0deg);
            }
            25% {
                transform: scale(1.2) rotate(-10deg);
            }
            75% {
                transform: scale(1.2) rotate(10deg);
            }
        }

        .toy-cooldown {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 13px;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
        }

        .toy-cooldown.visible {
            display: flex;
        }

        .toy.disabled {
            opacity: 0.4;
            pointer-events: none;
        }

        /* Toys taken outside */
        .toy-outside {
            position: fixed;
            width: 70px;
            height: 70px;
            cursor: grab;
            z-index: 1000;
            transition: transform 0.05s ease;
            user-select: none;
            display: flex;
            align-items: center;
            justify-content: center;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.2));
        }

        .toy-outside:active {
            cursor: grabbing;
        }

        .toy-outside.playing {
            animation: toy-bounce 0.5s ease-in-out;
        }

        /* Ball toy - cute soccer ball */
        .ball-toy {
            width: 60px;
            height: 60px;
            background: radial-gradient(circle at 30% 30%, #ffffff 0%, #f0f0f0 100%);
            border-radius: 50%;
            box-shadow: 
                inset -8px -8px 16px rgba(0,0,0,0.1),
                3px 3px 8px rgba(0,0,0,0.15);
            position: relative;
            overflow: hidden;
        }

        .ball-toy::before {
            content: '';
            position: absolute;
            width: 25px;
            height: 25px;
            background: #2d3436;
            border-radius: 50%;
            top: 12px;
            left: 18px;
        }

        .ball-toy::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            background: #2d3436;
            border-radius: 50%;
            bottom: 10px;
            right: 12px;
        }

        .ball-patch {
            position: absolute;
            width: 18px;
            height: 18px;
            background: #2d3436;
            border-radius: 50%;
        }

        .ball-patch:nth-child(1) { top: 8px; left: 8px; }
        .ball-patch:nth-child(2) { top: 35px; left: 35px; }
        .ball-patch:nth-child(3) { bottom: 8px; left: 35px; }

        .ball-toy.bouncing {
            animation: ball-bounce 0.6s ease-out;
        }

        @keyframes ball-bounce {
            0% {
                transform: translateY(0) scaleY(1);
            }
            30% {
                transform: translateY(-100px) scaleY(1);
            }
            50% {
                transform: translateY(0) scaleY(0.7) scaleX(1.3);
            }
            70% {
                transform: translateY(-50px) scaleY(1);
            }
            100% {
                transform: translateY(0) scaleY(1);
            }
        }

        /* Teddy bear toy - super cute */
        .teddy-toy {
            width: 65px;
            height: 75px;
            position: relative;
        }

        .teddy-body {
            width: 45px;
            height: 45px;
            background: linear-gradient(180deg, #d4b896 0%, #b8956a 100%);
            border-radius: 50% 50% 45% 45%;
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1;
            box-shadow: inset -4px -4px 8px rgba(0,0,0,0.1);
        }

        .teddy-belly {
            width: 28px;
            height: 32px;
            background: #e8d4b8;
            border-radius: 50%;
            position: absolute;
            bottom: 5px;
            left: 50%;
            transform: translateX(-50%);
        }

        .teddy-ear {
            width: 18px;
            height: 18px;
            background: linear-gradient(180deg, #c4a57b 0%, #a67c52 100%);
            border-radius: 50%;
            position: absolute;
            top: 10px;
            z-index: 2;
        }

        .teddy-ear.left { left: 3px; }
        .teddy-ear.right { right: 3px; }

        .teddy-ear-inner {
            width: 10px;
            height: 10px;
            background: #ffb6c1;
            border-radius: 50%;
            position: absolute;
            top: 4px;
            left: 4px;
        }

        .teddy-head {
            width: 45px;
            height: 42px;
            background: linear-gradient(180deg, #d4b896 0%, #b8956a 100%);
            border-radius: 50%;
            position: absolute;
            top: 12px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 3;
            box-shadow: inset -3px -3px 6px rgba(0,0,0,0.1);
        }

        .teddy-face {
            position: absolute;
            top: 14px;
            left: 50%;
            transform: translateX(-50%);
            width: 28px;
            height: 22px;
            z-index: 4;
        }

        .teddy-eye {
            width: 7px;
            height: 7px;
            background: #2d2d2d;
            border-radius: 50%;
            position: absolute;
            top: 0;
        }

        .teddy-eye.left { left: 3px; }
        .teddy-eye.right { right: 3px; }

        .teddy-eye::after {
            content: '';
            position: absolute;
            width: 3px;
            height: 3px;
            background: white;
            border-radius: 50%;
            top: 1px;
            left: 2px;
        }

        .teddy-snout {
            width: 16px;
            height: 12px;
            background: #e8d4b8;
            border-radius: 50%;
            position: absolute;
            top: 8px;
            left: 50%;
            transform: translateX(-50%);
        }

        .teddy-nose {
            width: 8px;
            height: 6px;
            background: #5c4033;
            border-radius: 50% 50% 50% 50% / 40% 40% 60% 60%;
            position: absolute;
            top: 1px;
            left: 50%;
            transform: translateX(-50%);
        }

        .teddy-mouth {
            position: absolute;
            bottom: 2px;
            left: 50%;
            transform: translateX(-50%);
            width: 8px;
            height: 4px;
            border-bottom: 2px solid #5c4033;
            border-radius: 0 0 8px 8px;
        }

        .teddy-squeeze {
            animation: teddy-squeeze 0.3s ease-out;
        }

        @keyframes teddy-squeeze {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(0.85) rotate(5deg);
            }
        }

        /* Rubber duck toy - super cute */
        .duck-toy {
            width: 65px;
            height: 60px;
            position: relative;
        }

        .duck-body {
            width: 60px;
            height: 45px;
            background: linear-gradient(180deg, #ffe066 0%, #ffd43b 100%);
            border-radius: 50% 50% 45% 45%;
            position: absolute;
            bottom: 0;
            box-shadow: inset -4px -4px 8px rgba(0,0,0,0.1);
        }

        .duck-wing {
            width: 25px;
            height: 20px;
            background: #fcc419;
            border-radius: 50%;
            position: absolute;
            top: 15px;
            left: 18px;
        }

        .duck-head {
            width: 38px;
            height: 38px;
            background: linear-gradient(180deg, #ffe066 0%, #ffd43b 100%);
            border-radius: 50%;
            position: absolute;
            top: 0;
            right: 5px;
            z-index: 2;
        }

        .duck-beak {
            width: 18px;
            height: 12px;
            background: linear-gradient(90deg, #ff6b6b 0%, #ff8787 100%);
            border-radius: 50%;
            position: absolute;
            top: 18px;
            right: -8px;
            z-index: 1;
        }

        .duck-beak::after {
            content: '';
            position: absolute;
            width: 18px;
            height: 6px;
            background: #ff8787;
            border-radius: 50%;
            bottom: 0;
            left: 0;
        }

        .duck-eye {
            width: 6px;
            height: 6px;
            background: #2d2d2d;
            border-radius: 50%;
            position: absolute;
            top: 12px;
            right: 14px;
            z-index: 3;
        }

        .duck-eye::after {
            content: '';
            position: absolute;
            width: 2px;
            height: 2px;
            background: white;
            border-radius: 50%;
            top: 1px;
            left: 2px;
        }

        .duck-bob {
            animation: duck-bob 0.5s ease-in-out;
        }

        @keyframes duck-bob {
            0%, 100% {
                transform: translateY(0) rotate(0deg);
            }
            25% {
                transform: translateY(-15px) rotate(-10deg);
            }
            75% {
                transform: translateY(-8px) rotate(5deg);
            }
        }

        /* Star toy - cute sparkly star */
        .star-toy {
            width: 65px;
            height: 65px;
            position: relative;
        }

        .star-shape {
            width: 60px;
            height: 60px;
            background: radial-gradient(circle at 35% 35%, #fff5c4 0%, #ffd700 40%, #ffa500 100%);
            clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 
                0 0 25px rgba(255, 215, 0, 0.6),
                inset 0 0 10px rgba(255, 255, 255, 0.5);
        }

        .star-face {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
            width: 30px;
            height: 25px;
        }

        .star-eye {
            width: 6px;
            height: 6px;
            background: #2d2d2d;
            border-radius: 50%;
            position: absolute;
            top: 5px;
        }

        .star-eye.left { left: 6px; }
        .star-eye.right { right: 6px; }

        .star-eye::after {
            content: '';
            position: absolute;
            width: 2px;
            height: 2px;
            background: white;
            border-radius: 50%;
            top: 1px;
            left: 2px;
        }

        .star-blush {
            width: 8px;
            height: 5px;
            background: rgba(255, 150, 150, 0.6);
            border-radius: 50%;
            position: absolute;
            top: 14px;
        }

        .star-blush.left { left: 4px; }
        .star-blush.right { right: 4px; }

        .star-mouth {
            width: 8px;
            height: 5px;
            border: 2px solid #d4a574;
            border-top: none;
            border-radius: 0 0 8px 8px;
            position: absolute;
            bottom: 3px;
            left: 50%;
            transform: translateX(-50%);
        }

        .star-sparkle {
            animation: star-sparkle 0.8s ease-in-out infinite;
        }

        @keyframes star-sparkle {
            0%, 100% {
                transform: translate(-50%, -50%) scale(1) rotate(0deg);
                filter: brightness(1);
            }
            50% {
                transform: translate(-50%, -50%) scale(1.15) rotate(15deg);
                filter: brightness(1.4);
            }
        }

        .egg-tart {
            width: 50px;
            height: 50px;
            cursor: pointer;
            transition: transform 0.2s ease;
            position: relative;
        }

        .egg-tart:hover {
            transform: scale(1.15) rotate(5deg);
        }

        .egg-tart:active {
            transform: scale(0.9);
        }

        .egg-tart-svg {
            width: 100%;
            height: 100%;
        }

        /* Pet button */
        .pet-btn {
            position: fixed;
            top: 50%;
            left: 20px;
            transform: translateY(-50%);
            background: linear-gradient(135deg, #ffb6c1 0%, #ff9eb5 100%);
            border: none;
            border-radius: 50%;
            width: 70px;
            height: 70px;
            cursor: pointer;
            font-size: 28px;
            box-shadow: 0 6px 20px rgba(255, 150, 180, 0.4);
            transition: all 0.2s ease;
        }

        .pet-btn:hover {
            transform: translateY(-50%) scale(1.1);
            box-shadow: 0 8px 25px rgba(255, 150, 180, 0.5);
        }

        .pet-btn:active {
            transform: translateY(-50%) scale(0.95);
        }

        .pet-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Info button and panel */
        .info-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, #d0c0e0 0%, #c0b0d8 100%);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 22px;
            box-shadow: 0 4px 16px rgba(180, 160, 200, 0.4);
            transition: all 0.2s ease;
            z-index: 200;
        }

        .info-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(180, 160, 200, 0.5);
        }

        /* Yell button */
        .yell-btn {
            position: fixed;
            top: 80px;
            left: 20px;
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #ffaaa5 0%, #ff8b85 100%);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            box-shadow: 0 4px 16px rgba(255, 139, 133, 0.4);
            transition: all 0.2s ease;
            z-index: 200;
            opacity: 0;
            pointer-events: none;
        }

        .yell-btn.visible {
            opacity: 1;
            pointer-events: auto;
        }

        .yell-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(255, 139, 133, 0.5);
        }

        .yell-btn:active {
            transform: scale(0.95);
        }

        /* Stolen tart animation */
        .stolen-tart {
            position: fixed;
            width: 40px;
            height: 40px;
            pointer-events: none;
            z-index: 150;
            transition: all 0.5s ease-out;
        }

        /* Indoor ball */
        .indoor-ball {
            position: fixed;
            width: 40px;
            height: 40px;
            background: radial-gradient(circle at 30% 30%, #ffffff 0%, #f0f0f0 100%);
            border-radius: 50%;
            box-shadow: 
                inset -8px -8px 16px rgba(0,0,0,0.1),
                3px 3px 8px rgba(0,0,0,0.15);
            z-index: 90;
            cursor: pointer;
        }

        .indoor-ball::before {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            background: #2d3436;
            border-radius: 50%;
            top: 8px;
            left: 12px;
        }

        .indoor-ball::after {
            content: '';
            position: absolute;
            width: 15px;
            height: 15px;
            background: #2d3436;
            border-radius: 50%;
            bottom: 6px;
            right: 8px;
        }

        /* Books panel */
        .books-panel {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(180, 160, 200, 0.3);
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 100;
        }

        .books-title {
            font-size: 12px;
            color: #8b7d9b;
            text-align: center;
            margin-bottom: 5px;
        }

        .book {
            width: 50px;
            height: 60px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            box-shadow: 2px 2px 8px rgba(0,0,0,0.15);
        }

        .book:hover {
            transform: scale(1.1) rotate(5deg);
        }

        .book:active {
            transform: scale(0.95);
        }

        .book.reading {
            animation: book-read 0.5s ease-in-out;
        }

        @keyframes book-read {
            0%, 100% {
                transform: scale(1) rotate(0deg);
            }
            25% {
                transform: scale(1.05) rotate(-5deg);
            }
            75% {
                transform: scale(1.05) rotate(5deg);
            }
        }

        .book-1 {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            border: 2px solid #ffccd5;
        }

        .book-2 {
            background: linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%);
            border: 2px solid #c2d8fb;
        }

        .book-3 {
            background: linear-gradient(135deg, #d4fc79 0%, #96e6a1 100%);
            border: 2px solid #c2f0a8;
        }

        .book-4 {
            background: linear-gradient(135deg, #fccb90 0%, #d57eeb 100%);
            border: 2px solid #e8a8d8;
        }

        /* Reading animation */
        .blob-reading {
            position: fixed;
            width: 80px;
            height: 60px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            z-index: 150;
            animation: reading-float 2s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes reading-float {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-10px);
            }
        }

        .reading-zzz {
            position: fixed;
            font-size: 20px;
            color: #a090b0;
            animation: zzz-float 1.5s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes zzz-float {
            0%, 100% {
                transform: translateY(0) scale(1);
                opacity: 0;
            }
            50% {
                opacity: 1;
            }
            100% {
                transform: translateY(-30px) scale(1.2);
                opacity: 0;
            }
        }

        .info-panel {
            position: fixed;
            top: 80px;
            left: 20px;
            width: 280px;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(180, 160, 200, 0.3);
            padding: 20px;
            z-index: 200;
            display: none;
            opacity: 0;
            transform: translateY(-10px);
            transition: all 0.3s ease;
        }

        .info-panel.visible {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        .info-panel h2 {
            font-size: 18px;
            color: #8b7d9b;
            margin-bottom: 15px;
            text-align: center;
            border-bottom: 2px solid #f0e8f8;
            padding-bottom: 10px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #f8f6ff;
        }

        .info-label {
            font-size: 13px;
            color: #a090b0;
            font-weight: 500;
        }

        .info-value {
            font-size: 14px;
            color: #6b5d7b;
            font-weight: 600;
        }

        .info-value.editable {
            cursor: pointer;
            color: #d0c0e0;
        }

        .info-value.editable:hover {
            color: #b8a0c8;
        }

        .name-input {
            width: 100%;
            padding: 8px 12px;
            border: 2px solid #e8e0f0;
            border-radius: 10px;
            font-size: 14px;
            color: #6b5d7b;
            background: #f8f6ff;
            margin-top: 5px;
            display: none;
        }

        .name-input.visible {
            display: block;
        }

        .personality-indicator {
            font-size: 24px;
            margin-left: 10px;
        }

        .care-tips {
            margin-top: 15px;
            padding: 12px;
            background: #f8f6ff;
            border-radius: 12px;
            font-size: 11px;
            color: #8b7d9b;
            line-height: 1.6;
        }

        .care-tips h3 {
            font-size: 12px;
            color: #6b5d7b;
            margin-bottom: 8px;
        }

        /* Personality-based blob styles */
        .blob-body.evil {
            filter: hue-rotate(280deg) saturate(1.3);
        }

        .blob-body.evil .mouth {
            border-radius: 12px 12px 0 0;
            border-top: 2px solid #e0d8e8;
            border-bottom: none;
            height: 8px;
        }

        .blob-body.sad {
            filter: grayscale(0.5) brightness(0.85);
        }

        .blob-body.sad .mouth {
            border-radius: 12px 12px 0 0;
            border-top: 2px solid #e0d8e8;
            border-bottom: none;
            height: 8px;
            transform: translateX(-50%) rotate(180deg);
        }

        .blob-body.happy-balanced .mouth {
            width: 20px;
            height: 12px;
            border-color: #d0c0e0;
        }

        /* Evil mode effects */
        .evil-aura {
            position: absolute;
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(180, 50, 180, 0.2) 0%, transparent 70%);
            animation: evil-pulse 2s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes evil-pulse {
            0%, 100% {
                transform: scale(1);
                opacity: 0.5;
            }
            50% {
                transform: scale(1.2);
                opacity: 0.8;
            }
        }

        /* Sad mode effects */
        .sad-tear {
            position: absolute;
            width: 8px;
            height: 12px;
            background: rgba(100, 150, 255, 0.6);
            border-radius: 0 50% 50% 50%;
            animation: tear-fall 3s ease-in-out infinite;
        }

        @keyframes tear-fall {
            0%, 100% {
                transform: translateY(0) rotate(45deg);
                opacity: 0;
            }
            20% {
                opacity: 1;
            }
            80% {
                transform: translateY(40px) rotate(45deg);
                opacity: 0;
            }
        }

        /* Floating hearts */
        .floating-heart {
            position: fixed;
            font-size: 24px;
            pointer-events: none;
            animation: float-up 1s ease-out forwards;
        }

        @keyframes float-up {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-60px) scale(1.5);
            }
        }

        /* Low stat warning */
        .stat-bar-fill.low {
            animation: pulse-warning 1s ease-in-out infinite;
        }

        @keyframes pulse-warning {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.6;
            }
        }
    </style>
</head>
<body>
    <!-- Info Button -->
    <button class="info-btn" id="infoBtn" title="Blob Info">‚ÑπÔ∏è</button>

    <!-- Yell Button (appears when blob is misbehaving) -->
    <button class="yell-btn" id="yellBtn" title="Yell at blob">üò†</button>

    <!-- Info Panel -->
    <div class="info-panel" id="infoPanel">
        <h2>ü•∫ Blob Info</h2>
        <div class="info-row">
            <span class="info-label">Name:</span>
            <span class="info-value editable" id="blobName" title="Click to change">Click to name</span>
        </div>
        <input type="text" class="name-input" id="nameInput" placeholder="Enter name..." maxlength="15">
        <div class="info-row">
            <span class="info-label">Gender:</span>
            <span class="info-value" id="blobGender">-</span>
        </div>
        <div class="info-row">
            <span class="info-label">Personality:</span>
            <span class="info-value" id="blobPersonality">
                <span class="personality-indicator" id="personalityIcon">üòä</span>
                <span id="personalityText">Normal</span>
            </span>
        </div>
        <div class="info-row">
            <span class="info-label">Care Score:</span>
            <span class="info-value" id="careScore">50/100</span>
        </div>
        <div class="info-row">
            <span class="info-label">Yells:</span>
            <span class="info-value" id="yellStats">0 (0 good)</span>
        </div>
        <div class="info-row">
            <span class="info-label">Books Read:</span>
            <span class="info-value" id="booksRead">0</span>
        </div>
        <div class="care-tips">
            <h3>üí° Care Tips</h3>
            <div id="careTipsText">
                Keep hunger and love balanced for a happy blob! Too much love makes them mischievous. Too little makes them sad.
            </div>
        </div>
    </div>

    <div class="companion-container">
        <div class="blob">
            <div class="blob-body" id="blobBody">
                <div class="accessory bow" id="bow">
                    <div class="bow-left"></div>
                    <div class="bow-right"></div>
                    <div class="bow-center"></div>
                </div>
                <div class="accessory glasses" id="glasses">
                    <div class="glasses-frame left"></div>
                    <div class="glasses-frame right"></div>
                    <div class="glasses-bridge"></div>
                </div>
                <div class="accessory hat" id="hat">
                    <div class="hat-pom"></div>
                    <div class="hat-crown"></div>
                    <div class="hat-brim"></div>
                </div>
                <div class="face">
                    <div class="eye left" id="eyeLeft">
                        <div class="pupil" id="pupilLeft"></div>
                    </div>
                    <div class="eye right" id="eyeRight">
                        <div class="pupil" id="pupilRight"></div>
                    </div>
                    <div class="cheek left" id="cheekLeft"></div>
                    <div class="cheek right" id="cheekRight"></div>
                    <div class="mouth" id="mouth"></div>
                </div>
            </div>
            <div class="blob-shadow"></div>
        </div>
    </div>

    <!-- Stats Panel -->
    <div class="stats-panel">
        <div class="stat-row">
            <span class="stat-icon">üçñ</span>
            <span class="stat-label">Hunger</span>
            <div class="stat-bar-container">
                <div class="stat-bar-fill hunger" id="hungerBar" style="width: 100%;" data-percent="100%"></div>
            </div>
        </div>
        <div class="stat-row">
            <span class="stat-icon">üíï</span>
            <span class="stat-label">Love</span>
            <div class="stat-bar-container">
                <div class="stat-bar-fill love" id="loveBar" style="width: 100%;" data-percent="100%"></div>
            </div>
        </div>
    </div>

    <!-- Pet Button -->
    <button class="pet-btn" id="petBtn" title="Pet the blob!">üëã</button>

    <!-- Toys Panel -->
    <div class="toys-panel">
        <div class="toys-title">üß∏ Toys</div>
        <div class="toys-hint" id="toysHint" style="display: block;">Drag to play!</div>
        <div class="toy" id="toy1" title="Ball">
            ‚öΩ
            <div class="toy-cooldown" id="toy1Cooldown"></div>
        </div>
        <div class="toy" id="toy2" title="Teddy Bear">
            üß∏
            <div class="toy-cooldown" id="toy2Cooldown"></div>
        </div>
        <div class="toy" id="toy3" title="Rubber Duck">
            ü¶Ü
            <div class="toy-cooldown" id="toy3Cooldown"></div>
        </div>
        <div class="toy" id="toy4" title="Star">
            ‚≠ê
            <div class="toy-cooldown" id="toy4Cooldown"></div>
        </div>
    </div>

    <!-- Egg Tarts Panel -->
    <div class="tarts-panel">
        <div class="tarts-title">ü•ß Egg Tarts</div>
        <div class="egg-tart" id="tart1">
            <svg class="egg-tart-svg" viewBox="0 0 100 100">
                <ellipse cx="50" cy="55" rx="40" ry="35" fill="#f4d4a4"/>
                <ellipse cx="50" cy="52" rx="36" ry="30" fill="#f9e8c8"/>
                <ellipse cx="50" cy="48" rx="32" ry="26" fill="#f5d76e"/>
                <ellipse cx="50" cy="45" rx="28" ry="22" fill="#f0c84a"/>
                <ellipse cx="42" cy="42" rx="6" ry="5" fill="#d4a83a" opacity="0.6"/>
                <ellipse cx="58" cy="44" rx="5" ry="4" fill="#d4a83a" opacity="0.6"/>
                <ellipse cx="50" cy="50" rx="4" ry="3" fill="#d4a83a" opacity="0.5"/>
            </svg>
        </div>
        <div class="egg-tart" id="tart2">
            <svg class="egg-tart-svg" viewBox="0 0 100 100">
                <ellipse cx="50" cy="55" rx="40" ry="35" fill="#f4d4a4"/>
                <ellipse cx="50" cy="52" rx="36" ry="30" fill="#f9e8c8"/>
                <ellipse cx="50" cy="48" rx="32" ry="26" fill="#f5d76e"/>
                <ellipse cx="50" cy="45" rx="28" ry="22" fill="#f0c84a"/>
                <ellipse cx="42" cy="42" rx="6" ry="5" fill="#d4a83a" opacity="0.6"/>
                <ellipse cx="58" cy="44" rx="5" ry="4" fill="#d4a83a" opacity="0.6"/>
                <ellipse cx="50" cy="50" rx="4" ry="3" fill="#d4a83a" opacity="0.5"/>
            </svg>
        </div>
        <div class="egg-tart" id="tart3">
            <svg class="egg-tart-svg" viewBox="0 0 100 100">
                <ellipse cx="50" cy="55" rx="40" ry="35" fill="#f4d4a4"/>
                <ellipse cx="50" cy="52" rx="36" ry="30" fill="#f9e8c8"/>
                <ellipse cx="50" cy="48" rx="32" ry="26" fill="#f5d76e"/>
                <ellipse cx="50" cy="45" rx="28" ry="22" fill="#f0c84a"/>
                <ellipse cx="42" cy="42" rx="6" ry="5" fill="#d4a83a" opacity="0.6"/>
                <ellipse cx="58" cy="44" rx="5" ry="4" fill="#d4a83a" opacity="0.6"/>
                <ellipse cx="50" cy="50" rx="4" ry="3" fill="#d4a83a" opacity="0.5"/>
            </svg>
        </div>
    </div>

    <!-- Books Panel -->
    <div class="books-panel">
        <div class="books-title">üìö Books</div>
        <div class="book book-1" id="book1" title="Story Book">üìñ</div>
        <div class="book book-2" id="book2" title="Science Book">üî¨</div>
        <div class="book book-3" id="book3" title="Art Book">üé®</div>
        <div class="book book-4" id="book4" title="Music Book">üéµ</div>
    </div>

    <div class="custom-panel" id="customPanel">
        <button class="custom-btn" data-accessory="bow">üéÄ Bow</button>
        <button class="custom-btn" data-accessory="glasses">üëì Glasses</button>
        <button class="custom-btn" data-accessory="hat">üßô Hat</button>
        <div class="color-divider"></div>
        <button class="color-swatch" data-color="ffffff" style="background: #ffffff;" title="White"></button>
        <button class="color-swatch" data-color="ffe4e8" style="background: #ffe4e8;" title="Pink"></button>
        <button class="color-swatch" data-color="e8f4f8" style="background: #e8f4f8;" title="Blue"></button>
        <button class="color-swatch" data-color="f0f8e8" style="background: #f0f8e8;" title="Green"></button>
        <button class="color-swatch" data-color="fff8e8" style="background: #fff8e8;" title="Cream"></button>
        <button class="color-swatch" data-color="f4e8f8" style="background: #f4e8f8;" title="Lavender"></button>
    </div>

    <button class="panel-toggle" id="panelToggle">‚ú® Dress Up</button>

    <!-- Take Out Button -->
    <button class="takeout-btn" id="takeoutBtn">üå≥ Take Out to Play</button>

    <!-- Clouds (hidden by default) -->
    <div class="cloud cloud-1" id="cloud1" style="display: none;"></div>
    <div class="cloud cloud-2" id="cloud2" style="display: none;"></div>

    <div class="info">
        üëã Pet | üß∏ Drag Toys | ü•ß Feed | üíï Love | üå≥ Explore
    </div>

    <script>
        // Audio context for generating sounds
        let audioContext = null;

        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        // Generate cute sounds using Web Audio API
        function playSound(type) {
            initAudio();
            if (!audioContext) return;

            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            const now = audioContext.currentTime;

            switch(type) {
                case 'happy':
                    // Cheerful ascending chime
                    oscillator.type = 'sine';
                    oscillator.frequency.setValueAtTime(523.25, now); // C5
                    oscillator.frequency.setValueAtTime(659.25, now + 0.1); // E5
                    oscillator.frequency.setValueAtTime(783.99, now + 0.2); // G5
                    gainNode.gain.setValueAtTime(0.3, now);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
                    oscillator.start(now);
                    oscillator.stop(now + 0.3);
                    break;

                case 'surprised':
                    // Quick rising squeak
                    oscillator.type = 'triangle';
                    oscillator.frequency.setValueAtTime(400, now);
                    oscillator.frequency.linearRampToValueAtTime(800, now + 0.15);
                    gainNode.gain.setValueAtTime(0.2, now);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.2);
                    oscillator.start(now);
                    oscillator.stop(now + 0.2);
                    break;

                case 'excited':
                    // Bouncy double chime
                    oscillator.type = 'sine';
                    oscillator.frequency.setValueAtTime(523.25, now);
                    oscillator.frequency.setValueAtTime(659.25, now + 0.08);
                    oscillator.frequency.setValueAtTime(783.99, now + 0.16);
                    oscillator.frequency.setValueAtTime(1046.50, now + 0.24);
                    gainNode.gain.setValueAtTime(0.25, now);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.4);
                    oscillator.start(now);
                    oscillator.stop(now + 0.4);
                    break;

                case 'squish':
                    // Soft boing sound
                    oscillator.type = 'sine';
                    oscillator.frequency.setValueAtTime(300, now);
                    oscillator.frequency.linearRampToValueAtTime(200, now + 0.1);
                    gainNode.gain.setValueAtTime(0.2, now);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.15);
                    oscillator.start(now);
                    oscillator.stop(now + 0.15);
                    break;

                case 'dress':
                    // Sparkly arpeggio
                    oscillator.type = 'sine';
                    oscillator.frequency.setValueAtTime(659.25, now); // E5
                    oscillator.frequency.setValueAtTime(783.99, now + 0.1); // G5
                    oscillator.frequency.setValueAtTime(987.77, now + 0.2); // B5
                    oscillator.frequency.setValueAtTime(1318.51, now + 0.3); // E6
                    gainNode.gain.setValueAtTime(0.2, now);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.4);
                    oscillator.start(now);
                    oscillator.stop(now + 0.4);
                    break;
            }
        }
        // Eye tracking with smooth interpolation
        const eyes = [
            { eye: document.getElementById('eyeLeft'), pupil: document.getElementById('pupilLeft') },
            { eye: document.getElementById('eyeRight'), pupil: document.getElementById('pupilRight') }
        ];
        const blobBody = document.getElementById('blobBody');
        const mouth = document.getElementById('mouth');
        const cheeks = [document.getElementById('cheekLeft'), document.getElementById('cheekRight')];
        const maxPupilDistance = 6;

        // Color palettes for different body colors
        const colorPalettes = {
            'ffffff': { top: '#ffffff', bottom: '#f8f6ff', shadow: 'rgba(180, 160, 200, 0.3)', inset: 'rgba(200, 180, 220, 0.2)' },
            'ffe4e8': { top: '#fff0f4', bottom: '#ffe4e8', shadow: 'rgba(220, 160, 180, 0.3)', inset: 'rgba(230, 180, 200, 0.2)' },
            'e8f4f8': { top: '#f0f8fb', bottom: '#e8f4f8', shadow: 'rgba(160, 180, 200, 0.3)', inset: 'rgba(180, 200, 220, 0.2)' },
            'f0f8e8': { top: '#f8fbf0', bottom: '#f0f8e8', shadow: 'rgba(160, 180, 140, 0.3)', inset: 'rgba(180, 200, 160, 0.2)' },
            'fff8e8': { top: '#fffdf8', bottom: '#fff8e8', shadow: 'rgba(200, 180, 140, 0.3)', inset: 'rgba(220, 200, 160, 0.2)' },
            'f4e8f8': { top: '#fbf8fd', bottom: '#f4e8f8', shadow: 'rgba(180, 140, 200, 0.3)', inset: 'rgba(200, 160, 220, 0.2)' }
        };
        let currentColor = 'ffffff';

        // Personality system
        let blobName = '';
        let blobGender = '';
        let personality = 'normal'; // normal, evil, sad, warming, perfect
        let careScore = 50; // 0-100, based on how well you care
        let loveGiven = 0; // Total love given
        let rejectionCount = 0; // Times user rejected blob when sad
        let playWhenSadCount = 0; // Times played when sad (warms up)
        let lastPersonalityUpdate = Date.now();
        let yellCount = 0; // Times yelled at blob
        let justifiedYells = 0; // Times yelled for actual misbehavior
        let indoorBallActive = false; // Evil blob playing ball indoors
        let stolenTartCount = 0; // Tarts stolen by evil blob
        let booksRead = 0; // Total books read
        let readingCount = [0, 0, 0, 0]; // Times each book was read

        // Book elements
        const books = [
            document.getElementById('book1'),
            document.getElementById('book2'),
            document.getElementById('book3'),
            document.getElementById('book4')
        ];
        const bookEmojis = ['üìñ', 'üî¨', 'üé®', 'üéµ'];
        const bookNames = ['Story', 'Science', 'Art', 'Music'];

        // Yell button element
        const yellBtn = document.getElementById('yellBtn');

        const genders = ['she', 'he'];
        const names = {
            neutral: ['Mochi', 'Pudding', 'Boba', 'Puff', 'Dango', 'Pon', 'Yuki', 'Hana'],
            feminine: ['Luna', 'Bella', 'Mimi', 'Sakura', 'Pearl', 'Coco', 'Nala', 'Kiki'],
            masculine: ['Max', 'Charlie', 'Oliver', 'Mochi', 'Pudding', 'Boba', 'Yuki', 'Sora']
        };

        // Info panel elements
        const infoBtn = document.getElementById('infoBtn');
        const infoPanel = document.getElementById('infoPanel');
        const blobNameEl = document.getElementById('blobName');
        const nameInput = document.getElementById('nameInput');
        const blobGenderEl = document.getElementById('blobGender');
        const personalityIcon = document.getElementById('personalityIcon');
        const personalityText = document.getElementById('personalityText');
        const careScoreEl = document.getElementById('careScore');
        const careTipsText = document.getElementById('careTipsText');
        const yellStatsEl = document.getElementById('yellStats');
        const booksReadEl = document.getElementById('booksRead');

        // Initialize blob info
        function initBlobInfo() {
            // Random gender
            blobGender = genders[Math.floor(Math.random() * genders.length)];
            blobGenderEl.textContent = blobGender === 'she' ? '‚ôÄÔ∏è She/Her' : '‚ôÇÔ∏è He/Him';

            // Suggest name based on gender
            suggestName();

            // Update personality display
            updatePersonalityDisplay();
        }

        function suggestName() {
            let nameList = names.neutral;
            if (blobGender === 'she') nameList = names.feminine;
            else if (blobGender === 'he') nameList = names.masculine;

            const randomName = nameList[Math.floor(Math.random() * nameList.length)];
            blobName = randomName;
            blobNameEl.textContent = blobName;
        }

        function updatePersonalityDisplay() {
            const personalities = {
                evil: { icon: 'üòà', text: 'Mischievous', tips: 'Your blob is getting too much love! They\'ll steal egg tarts ü•ß, play ball in the house ‚öΩ, and reject affection. Yell at them when misbehaving to correct them!' },
                sad: { icon: 'üò¢', text: 'Lonely', tips: 'Your blob feels neglected! They\'re too sad to play. Try petting them or giving them food to cheer up. Keep trying even if they reject you!' },
                warming: { icon: 'ü•∫', text: 'Warming Up', tips: 'Your blob is starting to trust you again! Keep playing with them and showing love. They\'re slowly opening up.' },
                perfect: { icon: '‚ú®', text: 'Well-Balanced', tips: 'Perfect care! Your blob is happy and well-behaved. Keep up the balanced care - not too much love, not too little!' },
                normal: { icon: 'üòä', text: 'Content', tips: 'Your blob is doing okay. Keep feeding them when hungry and giving love when they need it!' }
            };

            const p = personalities[personality];
            personalityIcon.textContent = p.icon;
            personalityText.textContent = p.text;
            careTipsText.textContent = p.tips;
            careScoreEl.textContent = `${Math.round(careScore)}/100`;
            yellStatsEl.textContent = `${yellCount} (${justifiedYells} good)`;
            booksReadEl.textContent = booksRead;

            // Show/hide yell button based on personality
            if (personality === 'evil' || indoorBallActive || stolenTartCount > 0) {
                yellBtn.classList.add('visible');
            } else {
                yellBtn.classList.remove('visible');
            }

            // Update blob appearance
            blobBody.classList.remove('evil', 'sad', 'happy-balanced');
            if (personality === 'evil') blobBody.classList.add('evil');
            else if (personality === 'sad') blobBody.classList.add('sad');
            else if (personality === 'perfect') blobBody.classList.add('happy-balanced');
        }

        function updatePersonality() {
            const now = Date.now();
            if (now - lastPersonalityUpdate < 2000) return; // Update max every 2 seconds
            lastPersonalityUpdate = now;

            // Calculate care score based on balance
            const loveRatio = love / 100;
            const hungerRatio = hunger / 100;

            // Evil: too much love (over 85) while hunger is low
            if (love > 85 && hunger > 50) {
                personality = 'evil';
                careScore = Math.max(0, careScore - 0.5);
                
                // Evil blob spawns indoor ball occasionally
                if (!indoorBallActive && Math.random() > 0.7) {
                    spawnIndoorBall();
                }
            }
            // Sad: both stats low
            else if (love < 30 && hunger < 40) {
                personality = 'sad';
                careScore = Math.max(0, careScore - 0.3);
            }
            // Warming up: was sad but getting attention
            else if (personality === 'sad' && (love > 50 || hunger > 60)) {
                personality = 'warming';
                careScore += 1;
            }
            // Perfect: balanced care
            else if (love > 50 && love < 80 && hunger > 50 && hunger < 90) {
                personality = 'perfect';
                careScore = Math.min(100, careScore + 0.2);
            }
            // Normal: everything else
            else {
                personality = 'normal';
                careScore = Math.max(40, Math.min(60, careScore));
            }

            careScore = Math.max(0, Math.min(100, careScore));
            updatePersonalityDisplay();
        }

        // Spawn indoor ball for evil blob
        function spawnIndoorBall() {
            if (indoorBallActive) return;
            
            indoorBallActive = true;
            
            const ball = document.createElement('div');
            ball.className = 'indoor-ball';
            ball.style.left = `${Math.random() * (window.innerWidth - 100) + 50}px`;
            ball.style.top = `${Math.random() * (window.innerHeight - 200) + 100}px`;
            document.body.appendChild(ball);
            
            // Ball bounces around
            let bx = Math.random() * 4 - 2;
            let by = Math.random() * 4 - 2;
            
            function bounceBall() {
                if (!document.body.contains(ball) || !indoorBallActive) {
                    ball.remove();
                    return;
                }
                
                let rect = ball.getBoundingClientRect();
                let newX = rect.left + bx;
                let newY = rect.top + by;
                
                // Bounce off walls
                if (newX <= 0 || newX >= window.innerWidth - 40) {
                    bx = -bx;
                    playSound('squish');
                }
                if (newY <= 0 || newY >= window.innerHeight - 40) {
                    by = -by;
                    playSound('squish');
                }
                
                ball.style.left = `${Math.max(0, Math.min(newX, window.innerWidth - 40))}px`;
                ball.style.top = `${Math.max(0, Math.min(newY, window.innerHeight - 40))}px`;
                
                requestAnimationFrame(bounceBall);
            }
            
            bounceBall();
            
            // Click ball to remove it (yell alternative)
            ball.addEventListener('click', (e) => {
                e.stopPropagation();
                ball.remove();
                indoorBallActive = false;
                createFloatingHeart(rect.left, rect.top, '‚úì');
                careScore = Math.min(100, careScore + 3);
                updatePersonalityDisplay();
            });
        }

        // Read book
        function readBook(bookIndex) {
            const book = books[bookIndex];
            if (!book || book.classList.contains('reading')) return;

            readingCount[bookIndex]++;
            booksRead++;

            // Visual feedback
            book.classList.add('reading');
            setTimeout(() => book.classList.remove('reading'), 500);

            // Create reading animation near blob
            const blobRect = blobBody.getBoundingClientRect();
            const readingBubble = document.createElement('div');
            readingBubble.className = 'blob-reading';
            readingBubble.textContent = bookEmojis[bookIndex];
            readingBubble.style.left = `${blobRect.left + 50}px`;
            readingBubble.style.top = `${blobRect.top - 30}px`;
            document.body.appendChild(readingBubble);

            // ZZZ animation
            const zzz = document.createElement('div');
            zzz.className = 'reading-zzz';
            zzz.textContent = 'üí≠';
            zzz.style.left = `${blobRect.left + 100}px`;
            zzz.style.top = `${blobRect.top - 20}px`;
            document.body.appendChild(zzz);

            setTimeout(() => {
                readingBubble.remove();
                zzz.remove();
            }, 2000);

            // Increase contentment based on books read
            const contentmentBoost = Math.min(5, 1 + Math.floor(booksRead / 5));
            careScore = Math.min(100, careScore + contentmentBoost);

            // Blob gets happy from reading
            setEmotion('happy');
            playSound('happy');

            // Floating hearts
            createFloatingHeart(blobRect.left + 50, blobRect.top - 40, '‚ù§Ô∏è');
            createFloatingHeart(blobRect.left + 50, blobRect.top - 60, bookEmojis[bookIndex]);

            // Show feedback
            createFloatingHeart(
                book.getBoundingClientRect().left + 25,
                book.getBoundingClientRect().top,
                '‚úì'
            );

            updatePersonalityDisplay();
            updateStats();
        }

        // Book click handlers
        books.forEach((book, index) => {
            book.addEventListener('click', (e) => {
                e.stopPropagation();
                readBook(index);
            });
        });

        // Info panel toggle
        infoBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            infoPanel.classList.toggle('visible');
        });

        // Name editing
        blobNameEl.addEventListener('click', () => {
            nameInput.classList.add('visible');
            nameInput.value = blobName;
            nameInput.focus();
        });

        nameInput.addEventListener('blur', () => {
            if (nameInput.value.trim()) {
                blobName = nameInput.value.trim();
                blobNameEl.textContent = blobName;
            }
            nameInput.classList.remove('visible');
        });

        nameInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                nameInput.blur();
            }
        });

        // Yell at blob
        yellBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            
            // Check if yell is justified (blob is actually misbehaving)
            const isJustified = (
                personality === 'evil' || 
                indoorBallActive || 
                stolenTartCount > 0
            );

            yellCount++;

            if (isJustified) {
                // Good yell - corrects behavior
                justifiedYells++;
                careScore = Math.min(100, careScore + 5);
                
                // Blob feels corrected
                setEmotion('surprised');
                playSound('surprised');
                createFloatingHeart(blobBody.getBoundingClientRect().left, blobBody.getBoundingClientRect().top, 'üò¢');
                
                // Reduce misbehavior
                if (personality === 'evil') {
                    personality = 'normal';
                    careScore = Math.min(100, careScore + 10);
                }
                indoorBallActive = false;
                stolenTartCount = Math.max(0, stolenTartCount - 1);
                
                // Remove indoor ball if exists
                const indoorBall = document.querySelector('.indoor-ball');
                if (indoorBall) indoorBall.remove();
                
                updatePersonalityDisplay();
                
                // Show feedback
                setTimeout(() => {
                    createFloatingHeart(
                        yellBtn.getBoundingClientRect().left,
                        yellBtn.getBoundingClientRect().top,
                        '‚úì'
                    );
                }, 100);
            } else {
                // Unjustified yell - makes blob more mischievous
                careScore = Math.max(0, careScore - 10);
                
                // Blob gets upset
                setEmotion('sad');
                createFloatingHeart(blobBody.getBoundingClientRect().left, blobBody.getBoundingClientRect().top, 'üíî');
                createFloatingHeart(yellBtn.getBoundingClientRect().left, yellBtn.getBoundingClientRect().top, 'üò†');
                
                // More likely to go evil
                if (personality === 'normal') {
                    personality = 'evil';
                }
                
                updatePersonalityDisplay();
            }
        });

        // Stats system
        let hunger = 100;
        let love = 100;
        const hungerDecayRate = 0.3; // Hunger decreases by 0.3 per second
        const loveDecayRate = 0.2; // Love decreases by 0.2 per second
        const hungerFeedAmount = 25; // Each tart restores 25 hunger
        const lovePetAmount = 15; // Each pet restores 15 love

        const hungerBar = document.getElementById('hungerBar');
        const loveBar = document.getElementById('loveBar');
        const petBtn = document.getElementById('petBtn');
        const eggTarts = [
            document.getElementById('tart1'),
            document.getElementById('tart2'),
            document.getElementById('tart3')
        ];
        let tartCooldowns = [false, false, false];

        // Toys system
        const toys = [
            document.getElementById('toy1'),
            document.getElementById('toy2'),
            document.getElementById('toy3'),
            document.getElementById('toy4')
        ];
        const toyCooldowns = [
            document.getElementById('toy1Cooldown'),
            document.getElementById('toy2Cooldown'),
            document.getElementById('toy3Cooldown'),
            document.getElementById('toy4Cooldown')
        ];
        const toysHint = document.getElementById('toysHint');
        const toyLoveAmount = 20; // Each toy gives 20 love
        const toyCooldownTime = 15000; // 15 seconds cooldown
        let toyCooldownTimers = [null, null, null, null];
        let toysOutside = [null, null, null, null]; // Track toys taken outside
        let toyPhysics = [
            { vx: 0, vy: 0, bouncing: false }, // Ball physics
            { vx: 0, vy: 0, bouncing: false }, // Teddy
            { vx: 0, vy: 0, bouncing: false }, // Duck
            { vx: 0, vy: 0, bouncing: false }  // Star
        ];

        function createFloatingEmoji(x, y, emoji) {
            const floating = document.createElement('div');
            floating.className = 'floating-heart';
            floating.textContent = emoji;
            floating.style.left = `${x}px`;
            floating.style.top = `${y}px`;
            document.body.appendChild(floating);
            setTimeout(() => floating.remove(), 1000);
        }

        // Create toy element based on type
        function createToyElement(toyIndex) {
            const container = document.createElement('div');
            container.className = 'toy-outside';

            switch(toyIndex) {
                case 0: // Ball - cute soccer ball
                    const ball = document.createElement('div');
                    ball.className = 'ball-toy';
                    // Add extra patches
                    for (let i = 0; i < 3; i++) {
                        const patch = document.createElement('div');
                        patch.className = 'ball-patch';
                        ball.appendChild(patch);
                    }
                    container.appendChild(ball);
                    break;

                case 1: // Teddy bear - super cute
                    const teddy = document.createElement('div');
                    teddy.className = 'teddy-toy';
                    teddy.innerHTML = `
                        <div class="teddy-body">
                            <div class="teddy-belly"></div>
                        </div>
                        <div class="teddy-ear left"><div class="teddy-ear-inner"></div></div>
                        <div class="teddy-ear right"><div class="teddy-ear-inner"></div></div>
                        <div class="teddy-head">
                            <div class="teddy-face">
                                <div class="teddy-eye left"></div>
                                <div class="teddy-eye right"></div>
                                <div class="teddy-snout">
                                    <div class="teddy-nose"></div>
                                    <div class="teddy-mouth"></div>
                                </div>
                            </div>
                        </div>
                    `;
                    container.appendChild(teddy);
                    break;

                case 2: // Rubber duck - super cute
                    const duck = document.createElement('div');
                    duck.className = 'duck-toy';
                    duck.innerHTML = `
                        <div class="duck-body">
                            <div class="duck-wing"></div>
                        </div>
                        <div class="duck-head"></div>
                        <div class="duck-beak"></div>
                        <div class="duck-eye"></div>
                    `;
                    container.appendChild(duck);
                    break;

                case 3: // Star - cute with face
                    const star = document.createElement('div');
                    star.className = 'star-toy';
                    star.innerHTML = `
                        <div class="star-shape"></div>
                        <div class="star-face">
                            <div class="star-eye left"></div>
                            <div class="star-eye right"></div>
                            <div class="star-blush left"></div>
                            <div class="star-blush right"></div>
                            <div class="star-mouth"></div>
                        </div>
                    `;
                    container.appendChild(star);
                    break;
            }

            return container;
        }

        // Squeak sound for teddy bear
        function playSqueakSound() {
            initAudio();
            if (!audioContext) return;

            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            const now = audioContext.currentTime;

            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(800, now);
            oscillator.frequency.setValueAtTime(600, now + 0.1);
            gainNode.gain.setValueAtTime(0.2, now);
            gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.2);

            oscillator.start(now);
            oscillator.stop(now + 0.2);
        }

        // Quack sound for duck
        function playQuackSound() {
            initAudio();
            if (!audioContext) return;

            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            const now = audioContext.currentTime;

            oscillator.type = 'triangle';
            oscillator.frequency.setValueAtTime(400, now);
            oscillator.frequency.linearRampToValueAtTime(300, now + 0.15);
            gainNode.gain.setValueAtTime(0.15, now);
            gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.2);

            oscillator.start(now);
            oscillator.stop(now + 0.2);
        }

        // Twinkle sound for star
        function playTwinkleSound() {
            initAudio();
            if (!audioContext) return;

            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            const now = audioContext.currentTime;

            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(1046.50, now); // C6
            oscillator.frequency.setValueAtTime(1318.51, now + 0.1); // E6
            gainNode.gain.setValueAtTime(0.15, now);
            gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.3);

            oscillator.start(now);
            oscillator.stop(now + 0.3);
        }

        // Take toy outside
        function takeToyOutside(toyIndex) {
            if (!isOutdoor || toysOutside[toyIndex]) return;

            // Create outside toy element
            const outsideToy = createToyElement(toyIndex);
            outsideToy.style.position = 'fixed';
            outsideToy.style.left = `${80 + toyIndex * 90}px`;
            outsideToy.style.top = `${window.innerHeight - 180}px`;
            outsideToy.style.zIndex = '50';
            document.body.appendChild(outsideToy);
            toysOutside[toyIndex] = outsideToy;

            // Disable original toy
            if (toys[toyIndex]) {
                toys[toyIndex].classList.add('disabled');
            }
            if (toysHint) {
                toysHint.style.display = 'block';
                toysHint.style.visibility = 'visible';
            }

            // Make draggable with physics
            makeDraggable(outsideToy, toyIndex);

            // Click to play
            outsideToy.addEventListener('click', (e) => {
                e.stopPropagation();
                playWithOutsideToy(toyIndex);
            });
        }

        // Return toy to panel
        function returnToyOutside(toyIndex) {
            if (toysOutside[toyIndex]) {
                toysOutside[toyIndex].remove();
                toysOutside[toyIndex] = null;
            }
            // Reset physics
            toyPhysics[toyIndex] = { vx: 0, vy: 0, bouncing: false };
            if (toys[toyIndex]) {
                toys[toyIndex].classList.remove('disabled');
            }

            // Check if all toys returned
            if (toysOutside.every(t => t === null)) {
                if (toysHint) {
                    toysHint.style.display = 'none';
                }
            }
        }

        // Make toy draggable
        function makeDraggable(element, toyIndex) {
            let isDragging = false;
            let startX, startY, initialX, initialY;
            let lastX, lastY, lastMoveTime;

            element.addEventListener('mousedown', (e) => {
                if (e.button !== 0) return; // Only left click
                isDragging = true;
                startX = e.clientX;
                startY = e.clientY;
                const rect = element.getBoundingClientRect();
                initialX = rect.left;
                initialY = rect.top;
                lastX = initialX;
                lastY = initialY;
                lastMoveTime = Date.now();
                element.style.cursor = 'grabbing';
                element.style.transition = 'none';
                element.style.zIndex = '1001';

                // Stop ball physics if it's the ball
                if (toyIndex === 0) {
                    toyPhysics[0].bouncing = false;
                    toyPhysics[0].vy = 0;
                    toyPhysics[0].vx = 0;
                }
            });

            document.addEventListener('mousemove', (e) => {
                if (!isDragging) return;
                const dx = e.clientX - startX;
                const dy = e.clientY - startY;
                const newX = initialX + dx;
                const newY = initialY + dy;
                element.style.left = `${newX}px`;
                element.style.top = `${newY}px`;

                // Track velocity for throw
                const now = Date.now();
                if (now - lastMoveTime > 16) { // ~60fps
                    lastX = newX;
                    lastY = newY;
                    lastMoveTime = now;
                }
            });

            document.addEventListener('mouseup', (e) => {
                if (isDragging) {
                    isDragging = false;
                    element.style.cursor = 'grab';
                    element.style.transition = 'transform 0.1s ease';
                    element.style.zIndex = '1000';

                    // Throw physics for ball
                    if (toyIndex === 0) {
                        const throwTime = Date.now() - lastMoveTime;
                        if (throwTime < 100) { // Quick throw
                            const vx = (e.clientX - lastX) * 0.3;
                            const vy = (e.clientY - lastY) * 0.3;
                            toyPhysics[0].vx = vx;
                            toyPhysics[0].vy = vy - 5; // Add upward force
                            toyPhysics[0].bouncing = true;
                        }
                    }
                }
            });
        }

        // Make panel toys draggable (drag out from panel)
        function makePanelToyDraggable(toyElement, toyIndex) {
            let isDragging = false;
            let dragGhost = null;
            let startX, startY;

            toyElement.addEventListener('mousedown', (e) => {
                if (e.button !== 0 || toyElement.classList.contains('disabled')) return;
                
                // Start dragging
                isDragging = true;
                startX = e.clientX;
                startY = e.clientY;

                // Create drag ghost (the toy being dragged)
                dragGhost = createToyElement(toyIndex);
                dragGhost.style.position = 'fixed';
                dragGhost.style.left = `${e.clientX - 35}px`;
                dragGhost.style.top = `${e.clientY - 35}px`;
                dragGhost.style.pointerEvents = 'none';
                dragGhost.style.opacity = '0.8';
                document.body.appendChild(dragGhost);

                toyElement.style.opacity = '0.3';
            });

            document.addEventListener('mousemove', (e) => {
                if (!isDragging || !dragGhost) return;
                
                dragGhost.style.left = `${e.clientX - 35}px`;
                dragGhost.style.top = `${e.clientY - 35}px`;
            });

            document.addEventListener('mouseup', (e) => {
                if (!isDragging) return;
                isDragging = false;

                // Check if dropped outside panel area
                const panelRect = document.querySelector('.toys-panel').getBoundingClientRect();
                const droppedOutside = (
                    e.clientX < panelRect.left || 
                    e.clientX > panelRect.right || 
                    e.clientY < panelRect.top || 
                    e.clientY > panelRect.bottom
                );

                if (droppedOutside && dragGhost) {
                    // Create permanent toy outside
                    dragGhost.style.position = 'fixed';
                    dragGhost.style.pointerEvents = 'auto';
                    dragGhost.style.opacity = '1';
                    dragGhost.style.left = `${e.clientX - 35}px`;
                    dragGhost.style.top = `${e.clientY - 35}px`;
                    document.body.appendChild(dragGhost);
                    toysOutside[toyIndex] = dragGhost;

                    // Disable panel toy
                    toyElement.classList.add('disabled');
                    if (toysHint) {
                        toysHint.style.display = 'block';
                        toysHint.style.visibility = 'visible';
                    }

                    // Make it draggable
                    makeDraggable(dragGhost, toyIndex);

                    // Click to play
                    dragGhost.addEventListener('click', (clickEvent) => {
                        clickEvent.stopPropagation();
                        playWithOutsideToy(toyIndex);
                    });
                } else {
                    // Return to panel - remove ghost
                    if (dragGhost) {
                        dragGhost.remove();
                        dragGhost = null;
                    }
                    toyElement.style.opacity = '';
                }
            });
        }

        // Play with outside toy
        function playWithOutsideToy(toyIndex) {
            const outsideToy = toysOutside[toyIndex];
            if (!outsideToy) return;

            // Evil blob plays but mischievously
            if (personality === 'evil') {
                love = Math.min(100, love + toyLoveAmount);
                
                const rect = outsideToy.getBoundingClientRect();
                createFloatingEmoji(rect.left + 25, rect.top, 'üòà');
                createFloatingEmoji(rect.left + 25, rect.top - 20, 'üéæ');
                
                // Still plays with toy but acts bratty
                setEmotion('excited');
                playSound('excited');
                
                // Set cooldown
                toyCooldowns[toyIndex].classList.add('visible');
                toyCooldowns[toyIndex].textContent = '15';
                
                let remaining = toyCooldownTime / 1000;
                toyCooldownTimers[toyIndex] = setInterval(() => {
                    remaining--;
                    toyCooldowns[toyIndex].textContent = remaining;
                    if (remaining <= 0) {
                        clearInterval(toyCooldownTimers[toyIndex]);
                        toyCooldownTimers[toyIndex] = null;
                        toyCooldowns[toyIndex].classList.remove('visible');
                    }
                }, 1000);
                
                updateStats();
                return;
            }

            // Sad blob might not want to play
            if (personality === 'sad' || personality === 'warming') {
                if (personality === 'sad' && playWhenSadCount < 5) {
                    // Too sad to play
                    createFloatingEmoji(outsideToy.getBoundingClientRect().left, outsideToy.getBoundingClientRect().top, 'üíî');
                    setEmotion('sad');
                    return;
                }
            }

            // Normal play
            // Add love
            love = Math.min(100, love + toyLoveAmount);

            // Visual feedback
            const rect = outsideToy.getBoundingClientRect();
            for (let i = 0; i < 3; i++) {
                setTimeout(() => {
                    createFloatingEmoji(
                        rect.left + 25 + Math.random() * 30,
                        rect.top + Math.random() * 40,
                        ['üíï', '‚ú®', 'üíñ', 'üéµ'][Math.floor(Math.random() * 4)]
                    );
                }, i * 150);
            }

            // Toy-specific interactions
            switch(toyIndex) {
                case 0: // Ball - bounce with physics
                    const ball = outsideToy.querySelector('.ball-toy');
                    if (ball) {
                        ball.classList.add('bouncing');
                        setTimeout(() => ball.classList.remove('bouncing'), 600);
                        // Add bounce physics
                        toyPhysics[toyIndex].vy = -8;
                        toyPhysics[toyIndex].bouncing = true;
                    }
                    break;

                case 1: // Teddy bear - squeak
                    const teddy = outsideToy.querySelector('.teddy-toy');
                    if (teddy) {
                        teddy.classList.add('teddy-squeeze');
                        setTimeout(() => teddy.classList.remove('teddy-squeeze'), 300);
                    }
                    playSqueakSound();
                    break;

                case 2: // Rubber duck - bob and quack
                    const duck = outsideToy.querySelector('.duck-toy');
                    if (duck) {
                        duck.classList.add('duck-bob');
                        setTimeout(() => duck.classList.remove('duck-bob'), 500);
                    }
                    playQuackSound();
                    break;

                case 3: // Star - sparkle and twinkle
                    const star = outsideToy.querySelector('.star-shape');
                    if (star) {
                        star.classList.add('star-sparkle');
                        setTimeout(() => star.classList.remove('star-sparkle'), 800);
                    }
                    playTwinkleSound();
                    break;
            }

            // Set cooldown
            toyCooldowns[toyIndex].classList.add('visible');
            toyCooldowns[toyIndex].textContent = '15';

            let remaining = toyCooldownTime / 1000;
            toyCooldownTimers[toyIndex] = setInterval(() => {
                remaining--;
                toyCooldowns[toyIndex].textContent = remaining;
                if (remaining <= 0) {
                    clearInterval(toyCooldownTimers[toyIndex]);
                    toyCooldownTimers[toyIndex] = null;
                    toyCooldowns[toyIndex].classList.remove('visible');
                }
            }, 1000);

            setEmotion('excited');
            playSound('excited');
            updateStats();
        }

        // Toy click handlers - play with toy in panel (indoor mode)
        // Also make them draggable to drag out
        toys.forEach((toy, index) => {
            // Make draggable from panel
            makePanelToyDraggable(toy, index);

            // Click to play (when not dragging)
            toy.addEventListener('click', (e) => {
                e.stopPropagation();
                // Can only play when indoors and not on cooldown and not being dragged
                if (!isOutdoor && !toyCooldownTimers[index] && !toy.classList.contains('disabled')) {
                    // Evil blob plays ball in the house (mischievous!)
                    if (personality === 'evil' && index === 0) {
                        createFloatingEmoji(toy.getBoundingClientRect().left, toy.getBoundingClientRect().top, 'üòà');
                        createFloatingEmoji(toy.getBoundingClientRect().left, toy.getBoundingClientRect().top - 20, '‚öΩ');
                        // Evil blob plays ball indoors anyway!
                        love = Math.min(100, love + toyLoveAmount);
                        setEmotion('excited');
                        playSound('excited');
                        
                        toy.classList.add('playing');
                        setTimeout(() => toy.classList.remove('playing'), 500);
                        
                        toyCooldowns[index].classList.add('visible');
                        toyCooldowns[index].textContent = '15';
                        
                        let remaining = toyCooldownTime / 1000;
                        toyCooldownTimers[index] = setInterval(() => {
                            remaining--;
                            toyCooldowns[index].textContent = remaining;
                            if (remaining <= 0) {
                                clearInterval(toyCooldownTimers[index]);
                                toyCooldownTimers[index] = null;
                                toyCooldowns[index].classList.remove('visible');
                            }
                        }, 1000);
                        
                        updateStats();
                        return;
                    }

                    // Sad blob too sad to play with toys
                    if (personality === 'sad' && playWhenSadCount < 5) {
                        createFloatingEmoji(toy.getBoundingClientRect().left, toy.getBoundingClientRect().top, 'üíî');
                        setEmotion('sad');
                        return;
                    }

                    // Normal play
                    // Add love
                    love = Math.min(100, love + toyLoveAmount);

                    // Visual feedback
                    const toyRect = toy.getBoundingClientRect();
                    for (let i = 0; i < 3; i++) {
                        setTimeout(() => {
                            createFloatingEmoji(
                                toyRect.left + 25 + Math.random() * 30,
                                toyRect.top + Math.random() * 40,
                                ['üíï', '‚ú®', 'üíñ', 'üéµ'][Math.floor(Math.random() * 4)]
                            );
                        }, i * 150);
                    }

                    // Animation
                    toy.classList.add('playing');
                    setTimeout(() => toy.classList.remove('playing'), 500);

                    // Set cooldown
                    toyCooldowns[index].classList.add('visible');
                    toyCooldowns[index].textContent = '15';

                    let remaining = toyCooldownTime / 1000;
                    toyCooldownTimers[index] = setInterval(() => {
                        remaining--;
                        toyCooldowns[index].textContent = remaining;
                        if (remaining <= 0) {
                            clearInterval(toyCooldownTimers[index]);
                            toyCooldownTimers[index] = null;
                            toyCooldowns[index].classList.remove('visible');
                        }
                    }, 1000);

                    setEmotion('excited');
                    playSound('excited');
                    updateStats();
                }
            });
        });

        // Ball physics update loop
        function updateBallPhysics() {
            if (!toysOutside[0]) {
                requestAnimationFrame(updateBallPhysics);
                return;
            }

            const physics = toyPhysics[0];
            if (physics.bouncing) {
                const ball = toysOutside[0];
                let currentY = parseFloat(ball.style.top) || window.innerHeight - 150;
                let currentX = parseFloat(ball.style.left) || 100;

                // Apply gravity
                physics.vy += 0.5; // Gravity
                currentY += physics.vy;
                currentX += physics.vx;

                // Ground collision
                const groundLevel = window.innerHeight - 100;
                if (currentY >= groundLevel) {
                    currentY = groundLevel;
                    physics.vy = -physics.vy * 0.6; // Bounce with energy loss
                    physics.vx *= 0.9; // Friction

                    // Stop if velocity is low
                    if (Math.abs(physics.vy) < 1) {
                        physics.vy = 0;
                        physics.bouncing = false;
                    }
                }

                // Wall collision
                if (currentX <= 0 || currentX >= window.innerWidth - 60) {
                    physics.vx = -physics.vx * 0.7;
                    currentX = Math.max(0, Math.min(currentX, window.innerWidth - 60));
                }

                ball.style.top = `${currentY}px`;
                ball.style.left = `${currentX}px`;
            }

            requestAnimationFrame(updateBallPhysics);
        }

        // Start physics loop
        updateBallPhysics();

        // Take out system
        const takeoutBtn = document.getElementById('takeoutBtn');
        const cloud1 = document.getElementById('cloud1');
        const cloud2 = document.getElementById('cloud2');
        let isOutdoor = false;
        let butterflies = [];

        function createButterfly() {
            const butterfly = document.createElement('div');
            butterfly.className = 'butterfly';
            butterfly.textContent = ['ü¶ã', 'üêù'][Math.floor(Math.random() * 2)];
            butterfly.style.top = `${Math.random() * 200 + 50}px`;
            butterfly.style.left = '-30px';
            butterfly.style.animationDelay = `${Math.random() * 2}s`;
            document.body.appendChild(butterfly);
            butterflies.push(butterfly);

            // Remove after animation
            setTimeout(() => {
                butterfly.remove();
                butterflies = butterflies.filter(b => b !== butterfly);
            }, 8000);
        }

        function toggleOutdoor() {
            isOutdoor = !isOutdoor;

            if (isOutdoor) {
                // Go outside
                document.body.classList.add('outdoor');
                cloud1.style.display = 'block';
                cloud2.style.display = 'block';
                takeoutBtn.textContent = 'üè† Go Back Inside';
                takeoutBtn.classList.add('out');

                // Create butterflies
                const butterflyInterval = setInterval(() => {
                    if (!isOutdoor) {
                        clearInterval(butterflyInterval);
                        return;
                    }
                    createButterfly();
                }, 2000);

                // Happy reaction
                setEmotion('excited');
                playSound('excited');

                // Bonus love for going outside
                love = Math.min(100, love + 10);
                updateStats();

                // Show hint about dragging toys
                if (toysHint) {
                    toysHint.style.display = 'block';
                    toysHint.textContent = 'Drag toys out to play!';
                }
            } else {
                // Go inside
                document.body.classList.remove('outdoor');
                cloud1.style.display = 'none';
                cloud2.style.display = 'none';
                takeoutBtn.textContent = 'üå≥ Take Out to Play';
                takeoutBtn.classList.remove('out');

                // Remove butterflies
                butterflies.forEach(b => b.remove());
                butterflies = [];

                // Return all toys when going inside
                toysOutside.forEach((_, index) => {
                    returnToyOutside(index);
                });

                // Happy reaction
                setEmotion('happy');
                playSound('happy');
            }
        }

        takeoutBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            toggleOutdoor();
        });

        function updateStats() {
            // Decay stats
            hunger = Math.max(0, hunger - hungerDecayRate);
            love = Math.max(0, love - loveDecayRate);

            // Update bars
            hungerBar.style.width = `${hunger}%`;
            loveBar.style.width = `${love}%`;
            hungerBar.setAttribute('data-percent', `${Math.round(hunger)}%`);
            loveBar.setAttribute('data-percent', `${Math.round(love)}%`);

            // Low stat warning
            hungerBar.classList.toggle('low', hunger < 30);
            loveBar.classList.toggle('low', love < 30);

            // Disable tarts on cooldown
            eggTarts.forEach((tart, index) => {
                tart.style.opacity = tartCooldowns[index] ? '0.5' : '1';
                tart.style.pointerEvents = tartCooldowns[index] ? 'none' : 'auto';
            });

            // Blob reacts when stats are low (but not if evil - they're too mischievous)
            if (personality !== 'evil' && (hunger < 20 || love < 20)) {
                blobBody.style.filter = 'grayscale(0.3)';
            } else if (personality !== 'evil') {
                blobBody.style.filter = 'none';
            }

            // Update personality based on care
            updatePersonality();
        }

        // Stats decay loop - update every second
        setInterval(updateStats, 1000);

        // Initialize blob info on load
        initBlobInfo();

        function createFloatingHeart(x, y) {
            const heart = document.createElement('div');
            heart.className = 'floating-heart';
            heart.textContent = 'üíï';
            heart.style.left = `${x}px`;
            heart.style.top = `${y}px`;
            document.body.appendChild(heart);

            setTimeout(() => heart.remove(), 1000);
        }

        function feedBlob(tartIndex) {
            if (tartCooldowns[tartIndex]) return;

            const tartRect = eggTarts[tartIndex].getBoundingClientRect();

            // Evil blob steals the tart!
            if (personality === 'evil') {
                setEmotion('excited');
                playSound('excited');
                
                // Animate tart flying to blob
                const stolenTart = document.createElement('div');
                stolenTart.className = 'stolen-tart';
                stolenTart.innerHTML = `
                    <svg viewBox="0 0 100 100" style="width:100%;height:100%">
                        <ellipse cx="50" cy="55" rx="40" ry="35" fill="#f4d4a4"/>
                        <ellipse cx="50" cy="52" rx="36" ry="30" fill="#f9e8c8"/>
                        <ellipse cx="50" cy="48" rx="32" ry="26" fill="#f5d76e"/>
                    </svg>
                `;
                stolenTart.style.left = `${tartRect.left}px`;
                stolenTart.style.top = `${tartRect.top}px`;
                document.body.appendChild(stolenTart);
                
                // Animate to blob
                const blobRect = blobBody.getBoundingClientRect();
                setTimeout(() => {
                    stolenTart.style.left = `${blobRect.left + 50}px`;
                    stolenTart.style.top = `${blobRect.top + 50}px`;
                    stolenTart.style.opacity = '0';
                }, 50);
                
                setTimeout(() => {
                    stolenTart.remove();
                    createFloatingHeart(blobRect.left + 50, blobRect.top, 'üòà');
                    createFloatingHeart(blobRect.left + 50, blobRect.top - 30, 'ü•ß');
                }, 500);
                
                // Still gets fed but acts mischievous
                hunger = Math.min(100, hunger + hungerFeedAmount);
                tartCooldowns[tartIndex] = true;
                stolenTartCount++;
                
                setTimeout(() => {
                    tartCooldowns[tartIndex] = false;
                }, 30000);
                
                updatePersonalityDisplay();
                updateStats();
                return;
            }

            // Sad blob eats but doesn't show much reaction
            if (personality === 'sad') {
                hunger = Math.min(100, hunger + hungerFeedAmount);
                tartCooldowns[tartIndex] = true;
                
                createFloatingHeart(tartRect.left + 25, tartRect.top, 'üíô');
                
                setEmotion('happy');
                playSound('happy');
                
                setTimeout(() => {
                    tartCooldowns[tartIndex] = false;
                }, 30000);
                updateStats();
                return;
            }

            // Normal feeding
            hunger = Math.min(100, hunger + hungerFeedAmount);
            tartCooldowns[tartIndex] = true;

            // Visual feedback
            createFloatingHeart(tartRect.left + 25, tartRect.top);

            // Happy reaction
            setEmotion('happy');
            playSound('happy');

            // Regenerate tart after 30 seconds
            setTimeout(() => {
                tartCooldowns[tartIndex] = false;
            }, 30000);

            updateStats();
        }

        function petBlob() {
            // Personality-based rejection
            if (personality === 'evil') {
                // Evil blob rejects love - plays hard to get
                setEmotion('surprised');
                playSound('surprised');
                createFloatingHeart(petBtn.getBoundingClientRect().left, petBtn.getBoundingClientRect().top, 'üí¢');
                rejectionCount++;
                return;
            }

            if (personality === 'sad') {
                // Sad blob might reject at first, but warms up with persistence
                if (playWhenSadCount < 3) {
                    setEmotion('sad');
                    createFloatingHeart(petBtn.getBoundingClientRect().left, petBtn.getBoundingClientRect().top, 'üíî');
                    playWhenSadCount++;
                    
                    // After enough attempts, starts warming up
                    if (playWhenSadCount >= 3) {
                        setTimeout(() => {
                            personality = 'warming';
                            updatePersonalityDisplay();
                        }, 1000);
                    }
                    return;
                }
            }

            // Normal petting
            love = Math.min(100, love + lovePetAmount);
            loveGiven++;

            // Visual feedback - multiple hearts
            const petRect = petBtn.getBoundingClientRect();
            for (let i = 0; i < 3; i++) {
                setTimeout(() => {
                    createFloatingHeart(
                        petRect.left + Math.random() * 50,
                        petRect.top + Math.random() * 30
                    );
                }, i * 150);
            }

            // Happy reaction
            setEmotion('happy');
            playSound('happy');

            updateStats();
        }

        // Pet button click
        petBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            petBlob();
        });

        // Egg tart clicks
        eggTarts.forEach((tart, index) => {
            tart.addEventListener('click', (e) => {
                e.stopPropagation();
                feedBlob(index);
            });
        });

        // Smooth eye tracking with lerp
        let targetPupilPositions = [{ x: 0, y: 0 }, { x: 0, y: 0 }];
        let currentPupilPositions = [{ x: 0, y: 0 }, { x: 0, y: 0 }];
        const lerpFactor = 0.15; // Lower = smoother but slower, higher = faster tracking

        function lerp(start, end, factor) {
            return start + (end - start) * factor;
        }

        function updatePupilPositions() {
            eyes.forEach((eyeObj, index) => {
                const { pupil } = eyeObj;
                const target = targetPupilPositions[index];
                const current = currentPupilPositions[index];

                // Linear interpolation for smooth movement
                current.x = lerp(current.x, target.x, lerpFactor);
                current.y = lerp(current.y, target.y, lerpFactor);

                pupil.style.transform = `translate(calc(-50% + ${current.x}px), calc(-50% + ${current.y}px))`;
            });

            requestAnimationFrame(updatePupilPositions);
        }

        // Start smooth animation loop
        updatePupilPositions();

        // Track cursor and update target positions
        document.addEventListener('mousemove', (e) => {
            eyes.forEach((eyeObj, index) => {
                const { eye } = eyeObj;
                const eyeRect = eye.getBoundingClientRect();
                const eyeCenterX = eyeRect.left + eyeRect.width / 2;
                const eyeCenterY = eyeRect.top + eyeRect.height / 2;

                const deltaX = e.clientX - eyeCenterX;
                const deltaY = e.clientY - eyeCenterY;
                const angle = Math.atan2(deltaY, deltaX);
                const distance = Math.min(
                    Math.sqrt(deltaX * deltaX + deltaY * deltaY) / 15,
                    maxPupilDistance
                );

                targetPupilPositions[index].x = Math.cos(angle) * distance;
                targetPupilPositions[index].y = Math.sin(angle) * distance;
            });

            // Subtle body lean toward cursor
            const containerRect = document.querySelector('.companion-container').getBoundingClientRect();
            const containerCenterX = containerRect.left + containerRect.width / 2;
            const leanAngle = Math.max(-3, Math.min(3, (e.clientX - containerCenterX) / 100));
            blobBody.style.transform = `translate(-50%, -50%) rotate(${leanAngle}deg)`;
        });

        // Blinking system
        function scheduleBlink() {
            const blinkDelay = Math.random() * 3000 + 2000;
            setTimeout(() => {
                blink();
                scheduleBlink();
            }, blinkDelay);
        }

        function blink() {
            eyes.forEach(({ eye }) => {
                eye.classList.add('blink');
            });

            setTimeout(() => {
                eyes.forEach(({ eye }) => {
                    eye.classList.remove('blink');
                });
            }, 120);
        }

        scheduleBlink();

        // Emotion system
        let clickCount = 0;
        let emotionTimeout;

        function setEmotion(emotion) {
            // Clear previous emotion
            blobBody.classList.remove('happy', 'surprised', 'excited');
            mouth.classList.remove('happy', 'surprised', 'excited');
            cheeks.forEach(cheek => cheek.classList.remove('blush'));
            eyes.forEach(({ eye }) => eye.classList.remove('wide'));

            // Apply new emotion
            switch(emotion) {
                case 'happy':
                    blobBody.classList.add('happy');
                    mouth.classList.add('happy');
                    cheeks.forEach(cheek => cheek.classList.add('blush'));
                    break;
                case 'surprised':
                    blobBody.classList.add('surprised');
                    mouth.classList.add('surprised');
                    eyes.forEach(({ eye }) => eye.classList.add('wide'));
                    break;
                case 'excited':
                    blobBody.classList.add('excited');
                    mouth.classList.add('excited');
                    cheeks.forEach(cheek => cheek.classList.add('blush'));
                    break;
            }

            // Reset after delay
            clearTimeout(emotionTimeout);
            emotionTimeout = setTimeout(() => {
                blobBody.classList.remove('happy', 'surprised', 'excited');
                mouth.classList.remove('happy', 'surprised', 'excited');
                cheeks.forEach(cheek => cheek.classList.remove('blush'));
                eyes.forEach(({ eye }) => eye.classList.remove('wide'));
            }, 800);
        }

        // Click on blob - emotion reaction
        blobBody.addEventListener('click', (e) => {
            e.stopPropagation();
            clickCount++;

            // Cycle through emotions based on click count
            const emotions = ['happy', 'surprised', 'excited'];
            const emotion = emotions[(clickCount - 1) % emotions.length];
            setEmotion(emotion);

            // Play sound for emotion
            playSound(emotion);

            // Squish effect
            blobBody.classList.remove('squish');
            void blobBody.offsetWidth;
            blobBody.classList.add('squish');

            // Play squish sound
            playSound('squish');
        });

        // Click anywhere else - just squish
        document.addEventListener('click', () => {
            blobBody.classList.remove('squish');
            void blobBody.offsetWidth;
            blobBody.classList.add('squish');
            playSound('squish');
        });

        // Dress up panel
        const panelToggle = document.getElementById('panelToggle');
        const customPanel = document.getElementById('customPanel');
        const accessories = {
            bow: document.getElementById('bow'),
            glasses: document.getElementById('glasses'),
            hat: document.getElementById('hat')
        };
        const accessoryBtns = document.querySelectorAll('.custom-btn');

        let currentAccessory = null;

        panelToggle.addEventListener('click', (e) => {
            e.stopPropagation();
            customPanel.classList.toggle('visible');
            panelToggle.textContent = customPanel.classList.contains('visible') ? '‚úï Close' : '‚ú® Dress Up';
        });

        accessoryBtns.forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.stopPropagation();
                const accessory = btn.dataset.accessory;

                // Toggle active state
                accessoryBtns.forEach(b => b.classList.remove('active'));

                if (currentAccessory === accessory) {
                    // Remove accessory
                    accessories[accessory].classList.remove('visible');
                    currentAccessory = null;
                } else {
                    // Remove previous accessory
                    if (currentAccessory) {
                        accessories[currentAccessory].classList.remove('visible');
                    }
                    // Add new accessory
                    accessories[accessory].classList.add('visible');
                    currentAccessory = accessory;
                    btn.classList.add('active');

                    // Happy reaction with sound
                    setEmotion('happy');
                    playSound('dress');
                }
            });
        });

        // Close panel when clicking outside
        document.addEventListener('click', () => {
            if (customPanel.classList.contains('visible')) {
                customPanel.classList.remove('visible');
                panelToggle.textContent = '‚ú® Dress Up';
            }
        });

        // Color swatches
        const colorSwatches = document.querySelectorAll('.color-swatch');

        function setBlobColor(color) {
            const palette = colorPalettes[color];
            if (!palette) return;

            blobBody.style.background = `linear-gradient(180deg, ${palette.top} 0%, ${palette.bottom} 100%)`;
            blobBody.style.boxShadow = `0 8px 32px ${palette.shadow}, inset 0 -8px 20px ${palette.inset}`;

            // Update active state
            colorSwatches.forEach(swatch => {
                swatch.classList.toggle('active', swatch.dataset.color === color);
            });

            currentColor = color;
            setEmotion('happy');
            playSound('dress');
        }

        colorSwatches.forEach(swatch => {
            swatch.addEventListener('click', (e) => {
                e.stopPropagation();
                setBlobColor(swatch.dataset.color);
            });
        });

        // Occasional random blink
        setInterval(() => {
            if (Math.random() > 0.7) {
                blink();
            }
        }, 10000);
    </script>
</body>
</html>
